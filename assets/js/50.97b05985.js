(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{572:function(e,n,o){"use strict";o.r(n);var t=o(18),s=Object(t.a)({},function(){var e=this,n=e.$createElement,o=e._self._c||n;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h2",{attrs:{id:"搭建nexus仓库服务器"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#搭建nexus仓库服务器","aria-hidden":"true"}},[e._v("#")]),e._v(" 搭建nexus仓库服务器")]),e._v(" "),o("h3",{attrs:{id:"要求："}},[o("a",{staticClass:"header-anchor",attrs:{href:"#要求：","aria-hidden":"true"}},[e._v("#")]),e._v(" 要求：")]),e._v(" "),o("ul",[o("li",[e._v("使用docker安装")]),e._v(" "),o("li",[e._v("支持docker、maven")]),e._v(" "),o("li",[e._v("数据持久化")]),e._v(" "),o("li")]),e._v(" "),o("h3",{attrs:{id:"安装计划"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#安装计划","aria-hidden":"true"}},[e._v("#")]),e._v(" 安装计划")]),e._v(" "),o("ul",[o("li",[e._v("数据持久化：将宿主机目录"),o("code",[e._v("/home/docker/nexus/nexus-data")]),e._v("挂在到容器的"),o("code",[e._v("/nexus-data")]),e._v("目录")]),e._v(" "),o("li",[o("code",[e._v("nexus")]),e._v("管理网页访问端口："),o("code",[e._v("8081")])]),e._v(" "),o("li",[o("code",[e._v("nexus")]),e._v("镜像上传下载端口："),o("code",[e._v("8082")])])]),e._v(" "),o("h3",{attrs:{id:"下载nexus3镜像"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#下载nexus3镜像","aria-hidden":"true"}},[e._v("#")]),e._v(" 下载nexus3镜像")]),e._v(" "),o("ul",[o("li",[o("p",[e._v("搜索nexus镜像 "),o("code",[e._v("docker search nexus")])]),e._v(" "),o("pre",[o("code",[e._v("  zhouchunsong@JuGuang:/home/jenkins/jenkins_home$ docker search nexus\n  NAME                                         DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED\n  sonatype/nexus                               Sonatype Nexus                                  346                  [OK]\n  sonatype/nexus3                              Sonatype Nexus Repository Manager 3             223                  \n  sonatype/docker-nexus3                       Sonatype Nexus 3 [DEPRECATED]                   25                   [OK]\n  clearent/nexus                               Sonatype Nexus container                        20                   \n  baselibrary/nexus                            ThoughtWorks Docker Image: nexus                7                    [OK]\n  accenture/adop-nexus                         ADOP Nexus                                      5                    [OK]\n  bradbeck/nexus-https                         Dockerized version of Nexus Repo Manager 3...   5                    [OK]\n  frekele/nexus                                docker run --rm --name nexus -p 8081:8081 ...   4                    [OK]\n  travix/sonatype-nexus                        Container to run Sonatype Nexus Profession...   3                    [OK]\n  shifudao/nexus3                              clone from nexus3 image but based from ope...   3                    [OK]\n  fabric8/nexus                                                                                2                    [OK]\n  madmuffin/nexus3                             Sonatype Nexus3 Milestone7 docker image         2                    [OK]\n  openshiftdemos/nexus                         Sonatype Nexus with JBoss Enterprise repos...   1                    \n  generix/nexus-data                           Data container for nexus                        1                    \n  descoped/nexus                               SonaType Nexus OSS Artifact Repository Man...   1                    [OK]\n  airdock/nexus                                Docker image for Nexus Repository Manager       0                    [OK]\n  ffung/nexus                                                                                  0                    \n  stangenberg/nexus                            Docker container featuring Sonatype's Nexu...   0                    [OK]\n  atzoum/aarch64-nexus3                        Nexus3 for Arm 64bit Architecture               0                    [OK]\n  ocadotechnology/nexus-data-pipeline-backup   Backup Nexus3 with AWS Data Pipeline and E...   0                    [OK]\n  mcreations/jenkins-with-nexus-support        Jenkins image with correct SSL config for ...   0                    [OK]\n  enieuw/nexus3-oss                            nexus3-oss                                      0                    [OK]\n  nayarsystems/nexus                           Nexus RPC + RethinkDB                           0                    \n  openfrontier/nexus                           Official Nexus docker plus p2 plugins.          0                    [OK]\n  trialgrid/nexus-docker                       Nexus docker image        \n")])])]),e._v(" "),o("li",[o("p",[e._v("下载nexus3镜像"),o("code",[e._v("sonatype/nexus3")]),e._v(",该镜像"),o("a",{attrs:{href:"https://hub.docker.com/r/sonatype/nexus3/",target:"_blank",rel:"noopener noreferrer"}},[e._v("使用教程"),o("OutboundLink")],1)]),e._v(" "),o("pre",[o("code",[e._v("  zhouchunsong@JuGuang:/home$ docker pull sonatype/nexus3\n  Using default tag: latest\n  latest: Pulling from sonatype/nexus3\n  7b6bb4652a1b: Pull complete \n  61b7deda4e4c: Pull complete \n  e8de5f20436b: Pull complete \n  6dd980b30942: Pull complete \n  82a5f5980c65: Pull complete \n  fb37f8a9062f: Pull complete \n  Digest: sha256:d259282800473f246419b4aba1141778abda3f8a13e0c94594feac5cf428ce54\n  Status: Downloaded newer image for sonatype/nexus3:latest\n  zhouchunsong@JuGuang:/home$ docker volume create --name nexus-data\n")])])])]),e._v(" "),o("h3",{attrs:{id:"运行nexus"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#运行nexus","aria-hidden":"true"}},[e._v("#")]),e._v(" 运行nexus")]),e._v(" "),o("ul",[o("li",[o("p",[e._v("首次启动，注意"),o("code",[e._v("home/docker/nexus/nexus-data")]),e._v("目录权限需要修改为"),o("code",[e._v("200:200")]),e._v("，对应容器内部的"),o("code",[e._v("nexus")]),e._v("用户，不然会因权限不足导致启动失败；"),o("code",[e._v("8081")]),e._v("为网页端口，"),o("code",[e._v("8082")]),e._v("为镜像上传下载端口")]),e._v(" "),o("pre",[o("code",[e._v('  zhouchunsong@JuGuang:/home/docker/nexus$ sudo chown -R 200:200 /home/docker/nexus/nexus-data/\t\t\n  zhouchunsong@JuGuang:/home/docker/nexus$ docker run -d -p 8081:8081 -p 8082:8082 --name nexus -v /home/docker/nexus/nexus-data:/nexus-data sonatype/nexus3\n  526c03402bf6bb3c86105453be55203365b4491c3448c7183227968f12a03e14\n  zhouchunsong@JuGuang:/home/docker/nexus$ docker ps \n  CONTAINER ID        IMAGE                 COMMAND                  CREATED             STATUS              PORTS                                                      NAMES\n  526c03402bf6        sonatype/nexus3       "bin/nexus run"          10 seconds ago      Up 9 seconds        0.0.0.0:8081->8081/tcp                                     nexus\n  1cd4c73638da        stilliard/pure-ftpd   "/bin/bash -c \'use..."   2 days ago          Up 24 hours         0.0.0.0:21->21/tcp, 0.0.0.0:30000-30209->30000-30209/tcp   ftpd_server\n')])])]),e._v(" "),o("li",[o("p",[e._v("修改默认端口")]),e._v(" "),o("ul",[o("li",[e._v("修改容器内 "),o("code",[e._v("/nexus-data/etc/nexus.properties")]),e._v(" 文件， "),o("code",[e._v("application-port=[your port]")]),e._v("，这里因为和其它应用冲突，所以修改为8092。")])])]),e._v(" "),o("li",[o("p",[e._v("测试工作是否正常")]),e._v(" "),o("ul",[o("li",[o("p",[e._v("命令行检测，正常运行时会输出"),o("code",[e._v("pong")])]),e._v(" "),o("pre",[o("code",[e._v("  zhouchunsong@JuGuang:/home/docker/nexus$ curl -u admin:admin123 http://localhost:8081/service/metrics/ping\n  pong\n")])])]),e._v(" "),o("li",[o("p",[e._v("浏览器打开"),o("a",{attrs:{href:"http://192.168.1.56:8092",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://192.168.1.56:8092"),o("OutboundLink")],1),e._v("，可正常显示网页")])])])]),e._v(" "),o("li",[o("p",[e._v("非首次启动，执行"),o("code",[e._v("docer start nexus")])])])]),e._v(" "),o("h3",{attrs:{id:"添加docker-hosted仓库"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#添加docker-hosted仓库","aria-hidden":"true"}},[e._v("#")]),e._v(" 添加docker hosted仓库")]),e._v(" "),o("ul",[o("li",[e._v("访问"),o("a",{attrs:{href:"http://192.168.1.56:8092",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://192.168.1.56:8092"),o("OutboundLink")],1),e._v("，使用默认账号/密码:"),o("code",[e._v("admin/admin123")]),e._v("登录")]),e._v(" "),o("li",[e._v("创建"),o("code",[e._v("docker(hosted)")]),e._v("仓库，名称"),o("code",[e._v("docker-hosted")]),e._v("，注意配置http端口，这里配置为"),o("code",[e._v("8093")]),e._v("，与启动参数一致")])]),e._v(" "),o("h3",{attrs:{id:"修改docker启动参数"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#修改docker启动参数","aria-hidden":"true"}},[e._v("#")]),e._v(" 修改docker启动参数")]),e._v(" "),o("ul",[o("li",[o("p",[e._v("由于我们添加的本地仓库只配置了http服务，而docker默认使用https，因此在docker启动文件"),o("code",[e._v("/etc/docker/daemon.json")]),e._v("中添加私有仓库地址："),o("code",[e._v('"insecure-registries":["http://192.168.1.56:8093"]')]),e._v("，"),o("code",[e._v("daemon.json")]),e._v("文件内容变为：")]),e._v(" "),o("pre",[o("code",[e._v('  {\n    "registry-mirrors": ["https://7uko0u1b.mirror.aliyuncs.com"],\n    "insecure-registries":["http://192.168.1.56:8093"]\n  }\n')])])]),e._v(" "),o("li",[o("p",[e._v("重启docker服务："),o("code",[e._v("service docker restart")])])])]),e._v(" "),o("h3",{attrs:{id:"向本地仓库push镜像"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#向本地仓库push镜像","aria-hidden":"true"}},[e._v("#")]),e._v(" 向本地仓库push镜像")]),e._v(" "),o("ul",[o("li",[o("p",[e._v("为待上传的镜像打标签，格式为"),o("code",[e._v("docker tag <imageId or imageName> <nexus-hostname>:<repository-port>/<image>:<tag>")])]),e._v(" "),o("pre",[o("code",[e._v("  zhouchunsong@JuGuang:/home/docker/nexus$ docker images\n  REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE\n  sonatype/nexus3       latest              9ded7bd31da5        37 hours ago        480MB\n  jenkins/jenkins       lts                 b36e8b881678        37 hours ago        810MB\n  httpd                 latest              b669148bb5a5        6 days ago          177MB\n  stilliard/pure-ftpd   latest              193339b4053f        2 weeks ago         439MB\n  ubuntu                16.04               ccc7a11d65b1        4 weeks ago         120MB\n  hello-world           latest              1815c82652c0        3 months ago        1.84kB\n  zhouchunsong@JuGuang:/home/docker/nexus$ docker tag hello-world 192.168.1.56:8093/hello-world:1.0\n  zhouchunsong@JuGuang:/home/docker/nexus$ docker images\n  REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE\n  sonatype/nexus3                 latest              9ded7bd31da5        37 hours ago        480MB\n  jenkins/jenkins                 lts                 b36e8b881678        37 hours ago        810MB\n  httpd                           latest              b669148bb5a5        6 days ago          177MB\n  stilliard/pure-ftpd             latest              193339b4053f        2 weeks ago         439MB\n  ubuntu                          16.04               ccc7a11d65b1        4 weeks ago         120MB\n  192.168.1.56:8082/hello-world   1.0                 1815c82652c0        3 months ago        1.84kB\n  hello-world                     latest              1815c82652c0        3 months ago        1.84kB\n")])])]),e._v(" "),o("li",[o("p",[e._v("登录仓库，默认账号/密码为："),o("code",[e._v("admin/admin123")]),e._v("，不登录就push镜像会提示："),o("code",[e._v("no basic auth credentials")])]),e._v(" "),o("pre",[o("code",[e._v("  zhouchunsong@JuGuang:/home/docker/nexus$ docker login 192.168.1.56:8093\n  Username (admin): admin\n  Password: \n  Login Succeeded\n")])])]),e._v(" "),o("li",[o("p",[e._v("push镜像")]),e._v(" "),o("pre",[o("code",[e._v("  zhouchunsong@JuGuang:/home/docker/nexus$ docker push 192.168.1.56:8082/hello-world:1.0\n  The push refers to a repository [192.168.1.56:8093/hello-world]\n  45761469c965: Layer already exists \n  1.0: digest: sha256:9fa82f24cbb11b6b80d5c88e0e10c3306707d97ff862a3018f22f9b49cef303a size: 524\n")])])]),e._v(" "),o("li",[o("p",[e._v("从"),o("a",{attrs:{href:"http://192.168.1.56:8092",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://192.168.1.56:8092"),o("OutboundLink")],1),e._v("上可以看到docker-hosted仓库中已经有了刚刚上传的镜像")])])]),e._v(" "),o("h3",{attrs:{id:"从本地仓库搜索镜像"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#从本地仓库搜索镜像","aria-hidden":"true"}},[e._v("#")]),e._v(" 从本地仓库搜索镜像")]),e._v(" "),o("pre",[o("code",[e._v("\tzhouchunsong@JuGuang:/home/docker/nexus$ docker search 192.168.1.56:8093/hello\n\tNAME                                DESCRIPTION   STARS     OFFICIAL   AUTOMATED\n\t192.168.1.56:8093/hello-world:1.0  \n")])]),e._v(" "),o("h3",{attrs:{id:"从本地仓库pull镜像"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#从本地仓库pull镜像","aria-hidden":"true"}},[e._v("#")]),e._v(" 从本地仓库pull镜像")]),e._v(" "),o("pre",[o("code",[e._v("\t\tzhouchunsong@JuGuang:/home/docker/nexus$ docker images\n\t\tREPOSITORY            TAG                 IMAGE ID            CREATED             SIZE\n\t\tsonatype/nexus3       latest              9ded7bd31da5        37 hours ago        480MB\n\t\tjenkins/jenkins       lts                 b36e8b881678        37 hours ago        810MB\n\t\thttpd                 latest              b669148bb5a5        6 days ago          177MB\n\t\tstilliard/pure-ftpd   latest              193339b4053f        2 weeks ago         439MB\n\t\tubuntu                16.04               ccc7a11d65b1        4 weeks ago         120MB\n\t\thello-world           latest              1815c82652c0        3 months ago        1.84kB\n\t\tzhouchunsong@JuGuang:/home/docker/nexus$ docker pull 192.168.1.56:8093/hello-world:1.0\n\t\t1.0: Pulling from hello-world\n\t\tDigest: sha256:9fa82f24cbb11b6b80d5c88e0e10c3306707d97ff862a3018f22f9b49cef303a\n\t\tStatus: Downloaded newer image for 192.168.1.56:8093/hello-world:1.0\n\t\tzhouchunsong@JuGuang:/home/docker/nexus$ docker images\n\t\tREPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE\n\t\tsonatype/nexus3                 latest              9ded7bd31da5        37 hours ago        480MB\n\t\tjenkins/jenkins                 lts                 b36e8b881678        37 hours ago        810MB\n\t\thttpd                           latest              b669148bb5a5        6 days ago          177MB\n\t\tstilliard/pure-ftpd             latest              193339b4053f        2 weeks ago         439MB\n\t\tubuntu                          16.04               ccc7a11d65b1        4 weeks ago         120MB\n\t\t192.168.1.56:8082/hello-world   1.0                 1815c82652c0        3 months ago        1.84kB\n\t\thello-world                     latest              1815c82652c0        3 months ago        1.84kB")])])])},[],!1,null,null,null);n.default=s.exports}}]);